{"ast":null,"code":"import Vuex from \"vuex\";\nimport Vue from \"vue\";\nimport Axios from \"axios\";\nVue.use(Vuex);\nconst userState = {\n  state: {\n    isUserLogged: false,\n    userRights: []\n  },\n  mutations: {\n    setLoginState(state, loginStatus) {\n      state.isUserLogged = loginStatus;\n    },\n    setUserRights(state, userRights) {\n      console.log(userRights);\n      state.userRights = userRights;\n    }\n  },\n  actions: {\n    // This action checks the user's login status and retrieves their rights.\n    checkUserLogin({\n      commit\n    }) {\n      // Send a GET request to the server to check the user's token from login using Axios.\n      Axios.get(\"http://localhost:5000/check-token-from-login\", {\n        withCredentials: true\n      }).then(response => {\n        // Check if the user is logged in based on the server response.\n        if (response.data.isLogged === true) {\n          // Extract user rights from the server response and flatten the array, removing duplicates using a Set.\n          const userRights = response.data.rights.map(roleRight => {\n            return roleRight.rights.map(right => {\n              return right.name;\n            });\n          });\n          const uniqueUserRights = [...new Set(userRights.flat())];\n\n          // Commit a Vuex mutation to set the login state to true.\n          commit(\"setLoginState\", true);\n\n          // Commit a Vuex mutation to set the user rights in the store.\n          commit(\"setUserRights\", uniqueUserRights);\n        } else {\n          // Commit a Vuex mutation to set the login state to false if the user is not logged in.\n          commit(\"setLoginState\", false);\n        }\n      }).catch(error => {\n        // Add error handling: Log the error to the console for debugging purposes.\n        console.log(error);\n      });\n    },\n    setIsUserLogged({\n      commit\n    }, isLogged) {\n      commit(\"setLoginState\", isLogged);\n    },\n    async updateUserRights({\n      commit\n    }) {\n      const response = await Axios.get(\"http://localhost:5000/user/get-user-rights\", {\n        withCredentials: true\n      });\n      const userRights = response.data.rights.map(roleRight => {\n        return roleRight.rights.map(right => {\n          return right.name;\n        });\n      });\n\n      // Flatten the array and remove duplicates using a Set\n      const uniqueUserRighs = [...new Set(userRights.flat())];\n      commit(\"setUserRights\", uniqueUserRighs);\n    }\n  },\n  getters: {\n    isUserLogged: state => state.isUserLogged,\n    userRights: state => state.userRights\n  }\n};\nexport default userState;","map":{"version":3,"names":["Vuex","Vue","Axios","use","userState","state","isUserLogged","userRights","mutations","setLoginState","loginStatus","setUserRights","console","log","actions","checkUserLogin","commit","get","withCredentials","then","response","data","isLogged","rights","map","roleRight","right","name","uniqueUserRights","Set","flat","catch","error","setIsUserLogged","updateUserRights","uniqueUserRighs","getters"],"sources":["C:/Users/jdlou/OneDrive/Plocha/crmproject/crm-frontend/src/State/userState.js"],"sourcesContent":["import Vuex from \"vuex\";\r\nimport Vue from \"vue\";\r\nimport Axios from \"axios\";\r\n\r\nVue.use(Vuex);\r\n\r\nconst userState = {\r\n  state: {\r\n    isUserLogged: false,\r\n    userRights: [],\r\n  },\r\n\r\n  mutations: {\r\n    setLoginState(state, loginStatus) {\r\n      state.isUserLogged = loginStatus;\r\n    },\r\n\r\n    setUserRights(state, userRights) {\r\n      console.log(userRights);\r\n\r\n      state.userRights = userRights;\r\n    },\r\n  },\r\n\r\n  actions: {\r\n    // This action checks the user's login status and retrieves their rights.\r\n    checkUserLogin({ commit }) {\r\n      // Send a GET request to the server to check the user's token from login using Axios.\r\n      Axios.get(\"http://localhost:5000/check-token-from-login\", {\r\n        withCredentials: true,\r\n      })\r\n        .then((response) => {\r\n          // Check if the user is logged in based on the server response.\r\n          if (response.data.isLogged === true) {\r\n            // Extract user rights from the server response and flatten the array, removing duplicates using a Set.\r\n            const userRights = response.data.rights.map((roleRight) => {\r\n              return roleRight.rights.map((right) => {\r\n                return right.name;\r\n              });\r\n            });\r\n            const uniqueUserRights = [...new Set(userRights.flat())];\r\n\r\n            // Commit a Vuex mutation to set the login state to true.\r\n            commit(\"setLoginState\", true);\r\n\r\n            // Commit a Vuex mutation to set the user rights in the store.\r\n            commit(\"setUserRights\", uniqueUserRights);\r\n          } else {\r\n            // Commit a Vuex mutation to set the login state to false if the user is not logged in.\r\n            commit(\"setLoginState\", false);\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          // Add error handling: Log the error to the console for debugging purposes.\r\n          console.log(error);\r\n        });\r\n    },\r\n\r\n    setIsUserLogged({ commit }, isLogged) {\r\n      commit(\"setLoginState\", isLogged);\r\n    },\r\n\r\n    async updateUserRights({ commit }) {\r\n      const response = await Axios.get(\r\n        \"http://localhost:5000/user/get-user-rights\",\r\n        {\r\n          withCredentials: true,\r\n        }\r\n      );\r\n\r\n      const userRights = response.data.rights.map((roleRight) => {\r\n        return roleRight.rights.map((right) => {\r\n          return right.name;\r\n        });\r\n      });\r\n\r\n      // Flatten the array and remove duplicates using a Set\r\n      const uniqueUserRighs = [...new Set(userRights.flat())];\r\n      commit(\"setUserRights\", uniqueUserRighs);\r\n    },\r\n  },\r\n\r\n  getters: {\r\n    isUserLogged: (state) => state.isUserLogged,\r\n    userRights: (state) => state.userRights,\r\n  },\r\n};\r\n\r\nexport default userState;\r\n"],"mappings":"AAAA,OAAOA,IAAI,MAAM,MAAM;AACvB,OAAOC,GAAG,MAAM,KAAK;AACrB,OAAOC,KAAK,MAAM,OAAO;AAEzBD,GAAG,CAACE,GAAG,CAACH,IAAI,CAAC;AAEb,MAAMI,SAAS,GAAG;EAChBC,KAAK,EAAE;IACLC,YAAY,EAAE,KAAK;IACnBC,UAAU,EAAE;EACd,CAAC;EAEDC,SAAS,EAAE;IACTC,aAAaA,CAACJ,KAAK,EAAEK,WAAW,EAAE;MAChCL,KAAK,CAACC,YAAY,GAAGI,WAAW;IAClC,CAAC;IAEDC,aAAaA,CAACN,KAAK,EAAEE,UAAU,EAAE;MAC/BK,OAAO,CAACC,GAAG,CAACN,UAAU,CAAC;MAEvBF,KAAK,CAACE,UAAU,GAAGA,UAAU;IAC/B;EACF,CAAC;EAEDO,OAAO,EAAE;IACP;IACAC,cAAcA,CAAC;MAAEC;IAAO,CAAC,EAAE;MACzB;MACAd,KAAK,CAACe,GAAG,CAAC,8CAA8C,EAAE;QACxDC,eAAe,EAAE;MACnB,CAAC,CAAC,CACCC,IAAI,CAAEC,QAAQ,IAAK;QAClB;QACA,IAAIA,QAAQ,CAACC,IAAI,CAACC,QAAQ,KAAK,IAAI,EAAE;UACnC;UACA,MAAMf,UAAU,GAAGa,QAAQ,CAACC,IAAI,CAACE,MAAM,CAACC,GAAG,CAAEC,SAAS,IAAK;YACzD,OAAOA,SAAS,CAACF,MAAM,CAACC,GAAG,CAAEE,KAAK,IAAK;cACrC,OAAOA,KAAK,CAACC,IAAI;YACnB,CAAC,CAAC;UACJ,CAAC,CAAC;UACF,MAAMC,gBAAgB,GAAG,CAAC,GAAG,IAAIC,GAAG,CAACtB,UAAU,CAACuB,IAAI,CAAC,CAAC,CAAC,CAAC;;UAExD;UACAd,MAAM,CAAC,eAAe,EAAE,IAAI,CAAC;;UAE7B;UACAA,MAAM,CAAC,eAAe,EAAEY,gBAAgB,CAAC;QAC3C,CAAC,MAAM;UACL;UACAZ,MAAM,CAAC,eAAe,EAAE,KAAK,CAAC;QAChC;MACF,CAAC,CAAC,CACDe,KAAK,CAAEC,KAAK,IAAK;QAChB;QACApB,OAAO,CAACC,GAAG,CAACmB,KAAK,CAAC;MACpB,CAAC,CAAC;IACN,CAAC;IAEDC,eAAeA,CAAC;MAAEjB;IAAO,CAAC,EAAEM,QAAQ,EAAE;MACpCN,MAAM,CAAC,eAAe,EAAEM,QAAQ,CAAC;IACnC,CAAC;IAED,MAAMY,gBAAgBA,CAAC;MAAElB;IAAO,CAAC,EAAE;MACjC,MAAMI,QAAQ,GAAG,MAAMlB,KAAK,CAACe,GAAG,CAC9B,4CAA4C,EAC5C;QACEC,eAAe,EAAE;MACnB,CACF,CAAC;MAED,MAAMX,UAAU,GAAGa,QAAQ,CAACC,IAAI,CAACE,MAAM,CAACC,GAAG,CAAEC,SAAS,IAAK;QACzD,OAAOA,SAAS,CAACF,MAAM,CAACC,GAAG,CAAEE,KAAK,IAAK;UACrC,OAAOA,KAAK,CAACC,IAAI;QACnB,CAAC,CAAC;MACJ,CAAC,CAAC;;MAEF;MACA,MAAMQ,eAAe,GAAG,CAAC,GAAG,IAAIN,GAAG,CAACtB,UAAU,CAACuB,IAAI,CAAC,CAAC,CAAC,CAAC;MACvDd,MAAM,CAAC,eAAe,EAAEmB,eAAe,CAAC;IAC1C;EACF,CAAC;EAEDC,OAAO,EAAE;IACP9B,YAAY,EAAGD,KAAK,IAAKA,KAAK,CAACC,YAAY;IAC3CC,UAAU,EAAGF,KAAK,IAAKA,KAAK,CAACE;EAC/B;AACF,CAAC;AAED,eAAeH,SAAS"},"metadata":{},"sourceType":"module","externalDependencies":[]}